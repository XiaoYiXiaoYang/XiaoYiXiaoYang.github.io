---
title: PHP中URL编码函数尝试
date: 2020-01-08 11:25:50
tags: [PHP]
categories: [学习笔记]
---

 描述遇到的中文乱码小bug

<!--more-->



#### 问题来源：在标签页面点击查询得到的标签，后台获取点击标签的中文，传递给一个变量，然后使用SQL语句like关键词模糊查询，但是发现英文可以正常查询，查询中文无结果。

#### 分析尝试：推断是因为编码的原因，也可能是服务器的原因，因为本地wamp环境是没有这个问题的，

```
$tags=input('tag');//获取传过来的关键词

$map=['a.keywords' => ['like','%'.$tags.'%']];//拼接查询关键词的语句
```

关键代码就这两句，为了测试bug所在，在两句中间加入输出语句dump($tags);die;

测试点击 “中文” 标签，得到输出 %E4%B8%AD%E6%96%87
看到这里大致可以确定是编码的问题了，但是还不知道是什么编码，猜测可能是utf8

百度了utf8编码与gb2312的转换函数

```
$content = iconv("utf-8","gb2312//IGNORE",$content);
```
测试之后输出未成功

又看到了url编码函数
尝试测试如下

```
echo urlencode("中文");
echo urldecode("%E4%B8%AD%E6%96%87");
```

得到输出正好与上文对应，则可以确定编码，使用urldecode解码输出的乱码即得到中文，即可实现与数据库的like模糊查询


**错误方向：在看到了乱码的文字之后，误以为可能是数据库的原因，百度了另外一种方法，将数据库字段设置为 binary...  但是这里是刚获得的文字，还没有执行与数据库的交互，所以这样的想法肯定是错误的**



------------

*2019-03-22 20:22:24 星期五
萧逸小杨*