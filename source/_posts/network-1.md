---
title: 计算机网络-IP
date: 2019-12-24 22:16:41
tags: [计算机网络]
categories: [学习笔记]
---


<center>
 网络层的网络互连，理解互联网是怎么工作的
</center>

<!--more-->



背景：电信网提供面向连接的可靠的传输服务。

虚电路服务：预留一切网络资源，双方沿着已建立的虚电路发送分组。

**网络层向上提供简单灵活的、无连接的、尽最大努力交付的数据报服务**。网络层不提供服务质量的承诺，所传送的分组可能出错、丢失、重复和失序，当然也不保证分组交付的时限。

由网络的主机中的运输层负责（差错处理、流量控制）

**虚拟互连网络**


将网络互相连接起来的中间设备

物理层使用的中间设备叫做**转发器**

数据链路层使用的中间设备叫**网桥或桥接器**

网络层使用的中间设备叫**路由器**

在网络层以上使用的中间设备叫**网关**




**IP地址分类**

A类：0[网络号7位][主机号24位]   1.0.0.0---126.0.0.0

B类：10[网络号14位][主机号16位] 128.1.0.0 ---- 191.255.255.255

C类：110[网络号21位][主机号8位]  192.0.1.0----233.255.255.255

D类：1110[多播地址]

E类：11110[保留]

A类、B类、C类网络号字段分别为1,2,3个字节长
D类为多播
E类保留

A类网络号8位，第一位0，可指派的网络号126个【2^7 - 2】，其中**网络号全0**的IP地址是保留地址为本网络，**网络号为127**的地址保留作本地软件环回测试本主机的进程之间的通信之用（127.0.0.1）（01111111.00000000.00000000.00000001）

A类主机号24位，每个网络中最大主机数【2^24 -2】，其中**主机号全0**的主机字段表示IP地址是“本主机”速连接到的单个网络地址；**主机号全1**表示该网络上的所有主机

B类网络号16位，前两位10，**网络号为128.0  [10000000.00000000]**的不指派，可以指派的最小网络地址为128.1.0.0，B类地址可指派网络数目【2^14-1】

B类主机号16位，每个网络最大主机数目【2^16 -2】，其中**主机号全0**和**主机号全1**的主机号扣除

C类网络号24位，前三位110，**网络号为192.0   [11000000.00000000]的不指派**,可以指派的最小网络地址为192.1.0.0，C类地址可指派网络数目为【2^21 -1】

C类主机号8位，每个网络最大主机数目【2^8 -1】,其中**主机号全0**和**主机号全1**的主机号扣除


- 在同一个局域网上的主机或路由器的IP地址中的网络号必须是一样的

- 用网桥互连的网段依然是一个局域网，只能有一个网络号

- 路由器总是具有两个或两个以上的IP地址，即路由器的每一个接口都有一个不同网络号的IP地址

- 当两个路由器直接相连时，在连线的端口处，可以分配也可以不分配IP地址。当分配了，则这一段就构成了只包含连线的网络。但是为了节省IP地址资源，对于这种仅由一段连线构成的特殊“网络”,现在也常常不分配IP地址





**IP数据报格式**

64位一行

版本 4位

首部长度 4位

区分服务 8位

总长度： 16位 首部+数据 的长度

标识：16位

标志：3位

片偏移：13位

生存时间：8位   TTL，表示最大跳数

协议：8位，指出次数据报携带的数据是使用何种协议，以便使目的主机的网络层知道将数据部分上交给哪个协议进行处理

首部校验和：16位

源地址：32位

目的地址：32位




#### IP转发分组的流程

路由表

| 目的主机所在网络 | 下一跳地址 |
| ---------------- | ---------- |
| 20.0.0.0         | 直接交付   |
| 15.0.0.0         | 20.0.0.7   |


**分组转发基于目的主机所在的网络**

**特殊：对特定的主机指明一个路由，叫特定主机路由**

**还可采用 默认路由来减少路由表所占用空间和搜索路由表所用的时间**

只要目的网络是其他网络，就一律选择默认路由，把数据报先间接交付连接其他网络的路由器，然后让路由器再转发给互联网中的下一个路由器，一直转发到目的网络上的路由器，最后进行直接交付


分组转发算法：


1.从数据包提取目的主机IP地址D，得出目的网路地址N

2.**N若就是与此路由器直接相连的某个网络地址，则进行直接交付，**不需要再经过其他路由器；否则间接交付走3

3.若路由表中有目的地址D的特定主机路由，则将数据传送给路由表中指明的下一条路由器，否则执行4

4.若路由表有到网络N的路由，则转发，否则执行5

5.若路由表有默认路由，则转发，否则执行6

6.报告转发分组出错


#### 划分子网




子网掩码：拿出主机号的几位作为子网号，除去全0和全1的情况

路由器在收到IP地址后，将IP地址每一位和子网掩码相与就得到了子网的网络地址

如：B类网络IP地址----145.13.3.10

**则凡是目的地职位145.13.x.x的数据包都被送到这个网络的路由器R1**


现在把它划分为3个子网

**划分的3个子网分别是 145.13.3.0 、 145.13.7.0 、 145.13.21.0**


**子网掩码拿出主机号的8位作为子网号，则子网掩码255.255.255.0**


**目的IP地址和子网掩码相与**得到计算结果**145.13.3.0**就是子网号

如果不划分子网，则使用默认子网掩码

**B类地址的子网划分**(16位网络号，16位主机号)

| 子网号的位数 | 子网掩码        | 子网数       | 每个子网的主机数 |
| ------------ | --------------- | ------------ | ---------------- |
| 2            | 255.255.192.0   | 2^2-2=2      | 2^14-2=16382     |
| 8            | 255.255.255.0   | 2^8-2=254    | 2^8-2=254        |
| 14           | 255.255.255.252 | 2^14-2=16382 | 2^2-2=2          |

-2除去了全0和全1


#### 使用子网时的分组转发

路由表

| 目的主机所在网络 | 子网掩码        | 下一跳地址 |
| ---------------- | --------------- | ---------- |
| 128.30.33.0      | 255.255.255.128 | 接口0      |
| 128.30.33.128    | 255.255.255.128 | 接口1      |
| 128.30.36.0      | 255.255.255.0   | R2         |



分组转发算法：


1.从数据包提取目的主机IP地址D，得出目的网路地址N

2.先判断是否为直接交付。**对路由器直接相连的网络逐个进行检查，用各网络的子网掩码和D相与，看结果是否和相应的网络地址匹配，匹配，则进行直接交付**，不需要再经过其他路由器；否则间接交付走3

3.若路由表中有目的地址D的特定主机路由，则将数据传送给路由表中指明的下一条路由器，否则执行4

4.对路由表的每一行，用其中的子网掩码和D相与，其结果为N，若N与改行的目的网络地址匹配，则把数据包传送给该行指明的下一条路由器，否则执行5

5.若路由表有默认路由，则转发，否则执行6

6.报告转发分组出错



2019-10-25 16:27:29 星期五