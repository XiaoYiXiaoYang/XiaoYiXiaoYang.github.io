---
title: 计算机网络--VPN和NAT
date: 2019-12-30 20:44:22
tags: [计算机网络]
categories: [学习笔记]
---

 虚拟专用网VPN和网络地址转换NAT

<!--more-->

### 虚拟专用网VPN


由于IP地址的紧缺，一个机构能申请到的IP地址数目也远小于本机构所拥有的主机数，一个机构内也不需要把所有的主机接入到外部的互联网


让一个机构内部的计算机由机构内部自行分配IP地址。


RFC指明了一些**专用地址**，这些地址只能用于一个机构的内部通信，而不能用于和互联网上的主机通信。

**在互联网中的所有路由器，对目的地址是专用地址的数据包一律不进行转发**

(1) 10.0.0.0 到 10.255.255.255

(2) 172.16.0.0 到 172.31.255.255

(3) 192.168.0.0 到 192.168.255.255



有时一个很大的机构的许多部门分布的范围很广，这些部门经常要互相交换信息。
1.租用电信公司的通信线路为本机构专用

2.利用公用的互联网作为本机构各专用网之间的通信载体，这样的专用网称为**虚拟专用网VPN**


**使用IP隧道技术实现的虚拟专用网络**

假定一个机构的两个场所建立**专用网络A和B，其网络地址分别为10.1.0.0 和 10.2.0.0**

每个场所要至少有一个合法全球IP地址，**两个网络的路由器有自己的全球IP地址125.1.2.3 和 194.4.5.6**

路由器R1收到数据报后，发现其目的网络必须通过互联网才能到达，就把整个的内部数据报进行加密，然后重新加上数据报的首部，封装成为在互联网上发送的外部数据报。

路由器R2在收到数据报后将其数据部分解密，恢复出原来的内部数据报，交付主机。


#### 还有一种VPN就是远程接入VPN

有流动员工在外地工作，公司需要和他们保持联系，远程接入VPN可以满足这种需求，在外地工作的员工通过拨号接入互联网，而驻留在员工个人电脑中的VPN软件可以在员工的个人电脑和公司的主机之间建立VPN隧道，因而外地员工与公司通信的内容也是保密的。



### 网络地址转换NAT

机构内的主机想要和互联网上的主机通信

在专用网连接到互联网的路由器上安装NAT软件，

NAT路由器收到从专用网内部的主机A发往互联网主机B的IP数据报，源IP地址是192.168.0.3 而目的IP是 213.18.2.4 。NAT路由器把IP数据报的源IP地址192.168.0.3转换为新的源IP地址172.38.1.5(即路由器全球IP地址)，然后转发出去


互联网的主机B收到数据报后以A的IP地址是172.38.1.5，然后作应答

当NAT路由器收到B的数据报，还要进行一次IP地址转换，通过NAT地址转换表，就可把IP数据报上的旧的IP地址172.38.1.5 转换成为新的IP地址192.168.0.3



| 方向 |    字段    | 旧的IP地址  | 新的IP地址  |
| :--: | :--------: | :---------: | :---------: |
|  出  |  源IP地址  | 192.168.0.3 | 172.38.1.5  |
|  入  | 目的IP地址 | 172.38.1.5  | 192.168.0.3 |

**当NAT路由器具有n个全球IP地址时，专用网内部最多可以同时拥有n台主机接入到互联网
**



为了更有效利用NAT路由器上的全球IP地址，把运输层的端口号加上

**网络地址与端口号转换NAPT**


| 方向 |         字段         | 旧的IP地址和端口 | 新的IP地址和端口 |
| :--: | :------------------: | :--------------: | :--------------: |
|  出  |  源IP地址:TCP端口号  | 192.168.0.3:3000 | 172.38.1.5:4001  |
|  出  |  源IP地址:TCP端口号  | 192.168.0.3:3000 | 172.38.1.5:4002  |
|  入  | 目的IP地址:TCP端口号 | 172.38.1.5:4001  | 192.168.0.3:3000 |
|  入  | 目的IP地址:TCP端口号 | 172.38.1.5:4002  | 192.168.0.3:3000 |





2019-10-27 16:29:34 星期日