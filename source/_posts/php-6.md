---
title: PHP上传文件问题
date: 2020-01-08 21:17:25
tags: [PHP]
categories: [技术分享]
---

 文件上传遇到的问题

<!--more-->

**ThinkPHP5.0框架上传图片方法**

------------

- 假设网页表单代码如下

```
<form action="/index/index/upload" enctype="multipart/form-data" method="post">
<input type="file" name="image" /> <br>
<input type="submit" value="上传" />
</form>
```

需要注意的是表单提交的action为提交的控制器下的方法，enctype为multipart/form-data
- 接着在需要响应的函数书写为

```php
public function upload(){
// 获取表单上传文件 例如上传了001.jpg
$file = request()->file('image');
// 移动到框架应用根目录/public/uploads/ 目录下
if($file){
$info = $file->move(ROOT_PATH . 'public' . DS . 'uploads');
if($info){
// 成功上传后 获取上传信息
// 输出 jpg
echo $info->getExtension();
// 输出 20160820/42a79759f284b767dfcb2a0197904287.jpg
echo $info->getSaveName();
// 输出 42a79759f284b767dfcb2a0197904287.jpg
echo $info->getFilename();
}else{
// 上传失败获取错误信息
echo $file->getError();
}
}
}
```



这样使用move函数将文件上传至public下的uploads目录
实际应用中也可以自己定义目录，并可以将文件路径最后的变化的文件名等存入数据库，方便在使用的时候读取路径，并统一加上一样的前缀路径即可。

------------

发现一个小问题，代码段前后分别空一行，则代码段顶格，否则整个代码段缩进了一下，显得和文字较为拥挤。这也是以后写博客的小细节把

**图片上传**
图片上传属于文件，不能直接存入数据库，所以需要将图片上传至服务器，然后将图片的路径信息存入数据库，这样才能实现图片的上传和读取。

**编辑文章**
如果是新增文章，直接输入文章全部信息存入数据库即可
但是如果是编辑文章，需要将信息读取出来，再将修改的信息对数据库更新，
文章缩略图是否更换问题，一开始设置可以更换，在编辑页面读出图片，并设置可以上传新的图片，而后台还是将图片上传，并把路径信息存入数据库，但是更新之后发现，数据库没有存入路径信息，代码调试发现，文件并没有上传，这里涉及读出的图片文件和新的上传的文件，不好动。

所以直接不能修改文章缩略图，就如同文章id一样，只是读出其内容，但是不能修改，否则造成图片路径及上传问题。

**文章内容插图**
上述只实现了文章带一个缩略图，而文章内还可以插入许多说明性的插图，本来也是可以上传的，然后把上传信息存入数据库，最后在显示页面读取路径即可，但是后台需要js代码支持，网上搜一下也有，因为内嵌markdown编辑器的代码就是网上搜的，但是再一细想想，我的网站空间就那么大，一直上传图片的话怕是放不下几篇文章，所以干脆没有上传文章插图的功能了...

------------

*
2019-03-02 16:04:27 星期六
萧逸小杨*