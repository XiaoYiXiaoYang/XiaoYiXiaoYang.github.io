---
title: 强制类型转换
date: 2019-12-14 22:44:43
tags: [C++]
categories: [技术分享]
---

 C++中的四种强制类型转换

<!--more-->

### 强制类型转换


**顶层const & 底层const**

对于一般的变量来说，其实没有顶层const和底层const的区别，而只有向指针这类复合类型的基本变量，才有这样的区别

```
只有对应指针，引用才会有区别：指针常量->顶层const，指针本身不可被修改。

int * const b = &a，a既可以通过a = x来改变，也可以通过*b = x来改变，但不可以把b指向别的地址、别的变量。例如声明

int c = 2；b=c即会报错。

```


```
指向常量的指针->底层const，指针本身可修改，但指向的值不可修改。

const int* b = &a，a可以通过a =  x来改变，但不可以通过*b = x来更改。

可以将b指向别的地址，变量。例如声明int c =2；b = c。

```


```
形式上区别二者通过看 * 和const的相对位置，int * const ptr，ptr是一个常指针，并且是一个指向int类型的常指针，
常指针即指针常量，即顶层const
（本身不可被修改，大概是因为指针比所修饰的对象高一层，所以叫顶层const）。
```

```
int const* ptr，首先ptr前面是一个*，则得知ptr是一个指针，前面的int const得知，是一个指向int类型常量的指针，
即指向常量的指针，即底层const（指向的对象是常量）
```

简单总结：

1.指针本身是常量 顶层const
2.指针指向的变量是常量  底层const



**const_cast**

用于将const的变量转换为非const

//用来去除变量、表达式的底层const属性。

我们需要改变其指向的内容，但却无法直接获取该变量，这时候使用const_cast可以去掉上述指针的const属性，并将其中地址赋予新指针，这个新指针就可以去更改内容。

```
如int a = 1;

const int * ptr = a;

int *ptr2 = const_cast<int *>(ptr);//假设a在此处很难获取，即重新定义一个int*指针，来接受ptr中除了const属性之外的东西。

*ptr2 = 2;

这时输出a，即等于2。
```



**static_cast**

```
用于各种隐式转换，比如非const转const，void*转指针，int转char，int转enum等 static_cast能用于多态向上转化，如果向下转能成功
```

（1）用于基本数据类型之间的转换
（2）把空指针转换成目标类型的空指针 
（3）把任何类型的表达式类型转换成void类型 
（4）用于类层次结构中父类和子类之间指针和引用的转换。 

```
子类转父类：子类总是包含父类的所有数据成员和函数成员，因此从子类转换到父类的指针对象可以没有任何顾虑的访问其（指父类）的成员。

父类转子类：而对于下行转换为什么不安全，是因为static_cast只是在编译时进行类型坚持，没有运行时的类型检查。
```


**dynamic_cast**


用于动态类型转换。**只能用于含有虚函数的类**，用于类层次间的向上和向下转化。只能转指针或引用。

向上转换：指的是子类向基类的转换

向下转换：指的是基类向子类的转换

它通过判断在执行到该语句的时候变量的运行时类型和要转换的类型是否相同来判断是否能够进行向下转换

```
如果一条dynamic_cast语句的转换目标是指针类型并且转换失败了，会返回一个空指针

当对引用类型转换失败时，程序抛出一个名为std::bad_cast的异常
```


**reinpreter_cast**

使用方法：reinpreter_cast<type-id> (expression)

说明：type-id必须是一个指针、引用、算术类型、函数指针或者成员指针。它可以把一个指针转换成一个整数，也可以把一个整数转换成一个指针（先把一个指针转换成一个整数，在把该整数转换成原类型的指针，还可以得到原先的指针值）。


reinterpret_cast可以转换任意一个32bit整数，包括所有的指针和整数。可以把任何整数转成指针，也可以把任何指针转成整数，以及把指针转化为任意类型的指针，威力最为强大！但不能将非32bit的实例转成指针。总之，只要是32bit的东东，怎么转都行！ 

因为任何指针可以被转换到void*，而void*可以被向后转换到任何指针（对于static_cast<> 和 reinterpret_cast<>转换都可以这样做），如果没有小心处理的话错误可能发生。 



2019-11-26 09:48:47 星期二