---
title: SSL详解
date: 2020-08-25 20:17:59
tags: [信息安全]
categories: [学习笔记]
---



从对称加密、非对称加密、数字证书、数字签名到SSL单双向握手

<!--more-->



## 对称非对称加密



**对称加密**：加密和解密使用同一个秘钥

**对称加密应用**：客户端 服务器使用同一个秘钥加密解密数据

**问题**：秘钥传输是不安全的，会泄露秘钥



**非对称加密**：加密和解密使用的秘钥不同，分为公钥和私钥

使用公钥进行加密，只有对应的私钥才能解密



借鉴：https://blog.csdn.net/jijianshuai/article/details/80582187  (小白也能看得懂，没错，我懂了)



**非对称加密应用**：

1.服务器生成公钥、私钥

2.服务器将公钥公开，客户端获得公钥，使用公钥加密数据，传输给服务器

3.服务器使用私钥解密，查看数据



**问题**：

1.如果服务器向客户端传输数据，服务器使用私钥加密，客户端使用公钥解密，其他客户端也知晓公钥，不安全

2.



**两对秘钥非对称加密应用**：

1.服务器有自己的公钥A1 私钥A2，客户端有自己的公钥B1，私钥B2

2.服务器客户端互相传递公钥A1，B1

3.客户端服务器传输数据都使用公钥加密，私钥解密



**问题**：

1.



**非对称加密+对称加密**

1.客户端有用于非对称加密的公钥A1、私钥A2

2.客户端向服务器请求，服务器把公钥A1传输给客户端

3.客户端随机生成一个用于对称加密的秘钥X，用公钥A1加密后传给服务器

4.服务器使用私钥A2解密，拿到对称加密秘钥X

5.双方使用对称加密秘钥X传数据



**问题**：

1.在上面的第二步，中间人可能劫持服务器传给客户端的公钥A1，换成自己伪造的公钥B1

2.客户端傻傻的拿到公钥B1，加密了秘钥X，传给服务器

3.中间人继续劫持后，使用私钥B2解密，再使用公钥A1加密后传给服务器

4.服务器拿到后使用私钥AA2解密

中间人就这样拿到了他们的对称加密秘钥X



为了避免这个问题需要解决：**客户端可以验证收到的公钥一定是服务器的公钥，而不是经过伪造**



## 证书



1.服务器向CA申请一份证书，证书里有服务器CN信息，公钥A1信息等

2.服务器将证书传给客户端

3.客户端取证书中的公钥



**同样的问题**：中间人可能劫持证书，伪造一个证书传给客户端



### 数字签名

数字签名的制作

1.CA拥有非对称加密的公钥M和私钥N

2.CA对证书的明文信息进行hash

3.对hash后的值用私钥N加密，得到**数字签名**

4.服务器把**数字签名**加在明文后，一起发送给客户端



客户端拿到证书验证过程：

1.拿到证书，得到明文T1，数字签名S1

2.用CA机构的公钥M对S1解密得到S2，成功则证明确实来自CA，得到hash值

3.用证书里说明的hash算法对明文T1进行hash得到T2

4.比较S2和T2是否相等，就能知道是否被篡改



**问题**：

1.中间人篡改证书原文

客户端验证私钥解密数字签名后的hash值和对明文hash的值不同。即S2 和 T2不同



2.中间人直接换掉证书

另一个客户端B也拿到了CA机构认证的证书，对证书掉包，则需要通过证书明文信息来判断



## 数字证书

1.服务器找CA申请证书，CA使用自己的私钥对服务器公钥和服务器CN等信息加密，生成**数字证书**

2.服务器给客户端传输信息加上数字签名、数字证书

3.客户端收到后用CA的公钥解密数字证书，拿到服务器公钥，然后验证数字签名





## SSL握手



**单向认证**

![单向认证握手过程图解](one-way.png)



**双向认证**



![双向认证握手过程图解](double-way.png)









**参考：**

https://www.jianshu.com/p/4932cb1499bf

https://blog.csdn.net/qq_31825569/article/details/79956967

